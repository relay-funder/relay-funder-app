---
description: |
  Guidelines and patterns for structuring, organizing, and implementing React components in this project.
globs: []
alwaysApply: true
---

# React Component Patterns

## Component Architecture

### Component Organization
- **UI Components**: Reusable components in [components/ui/](mdc:components/ui/)
- **Feature Components**: Domain-specific components organized by feature
- **Layout Components**: Page structure components in [components/page/](mdc:components/page/)
- **Form Components**: Form-related components with validation

### Component Structure
```typescript
// components/campaign/campaign-card.tsx
import { type Campaign } from '@/types/campaign';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';

interface CampaignCardProps {
  campaign: Campaign;
  onFavorite?: (campaignId: number) => void;
  showActions?: boolean;
  className?: string;
}

export function CampaignCard({
  campaign,
  onFavorite,
  showActions = true,
  className
}: CampaignCardProps) {
  return (
    <div className={cn('campaign-card', className)}>
      {/* Component implementation */}
    </div>
  );
}
```

## UI Component Library

### Radix UI Integration
The project uses Radix UI components as the foundation for the UI library:

```typescript
// components/ui/button.tsx
import { Slot } from '@radix-ui/react-slot';
import { cva, type VariantProps } from 'class-variance-authority';

const buttonVariants = cva(
  'inline-flex items-center justify-center rounded-md text-sm font-medium',
  {
    variants: {
      variant: {
        default: 'bg-primary text-primary-foreground hover:bg-primary/90',
        destructive: 'bg-destructive text-destructive-foreground hover:bg-destructive/90',
        outline: 'border border-input bg-background hover:bg-accent',
        secondary: 'bg-secondary text-secondary-foreground hover:bg-secondary/80',
        ghost: 'hover:bg-accent hover:text-accent-foreground',
        link: 'text-primary underline-offset-4 hover:underline',
      },
      size: {
        default: 'h-10 px-4 py-2',
        sm: 'h-9 rounded-md px-3',
        lg: 'h-11 rounded-md px-8',
        icon: 'h-10 w-10',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  }
);

interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean;
}

export function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: ButtonProps) {
  const Comp = asChild ? Slot : 'button';
  return (
    <Comp
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  );
}
```

### Component Composition
```typescript
// components/campaign/campaign-actions.tsx
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

export function CampaignActions({ campaign }: { campaign: Campaign }) {
  return (
    <Card>
      <CardHeader>
        <CardTitle>Campaign Actions</CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="flex items-center gap-2">
          <Badge variant={campaign.status === 'ACTIVE' ? 'default' : 'secondary'}>
            {campaign.status}
          </Badge>
        </div>
        <div className="flex gap-2">
          <Button variant="default">Edit Campaign</Button>
          <Button variant="outline">View Details</Button>
        </div>
      </CardContent>
    </Card>
  );
}
```

## Form Components

### Form Validation with React Hook Form
```typescript
// components/campaign/create-form.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';

const campaignSchema = z.object({
  title: z.string().min(1, 'Title is required'),
  description: z.string().min(1, 'Description is required'),
  fundingGoal: z.string().regex(/^\d+(\.\d+)?$/, 'Invalid amount'),
  startTime: z.string().datetime(),
  endTime: z.string().datetime(),
});

type CampaignFormData = z.infer<typeof campaignSchema>;

interface CampaignCreateFormProps {
  onSubmit: (data: CampaignFormData) => Promise<void>;
  isLoading?: boolean;
}

export function CampaignCreateForm({ onSubmit, isLoading }: CampaignCreateFormProps) {
  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<CampaignFormData>({
    resolver: zodResolver(campaignSchema),
  });

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
      <div>
        <Label htmlFor="title">Title</Label>
        <Input
          id="title"
          {...register('title')}
          aria-invalid={errors.title ? 'true' : 'false'}
        />
        {errors.title && (
          <p className="text-sm text-destructive">{errors.title.message}</p>
        )}
      </div>

      <div>
        <Label htmlFor="description">Description</Label>
        <Textarea
          id="description"
          {...register('description')}
          aria-invalid={errors.description ? 'true' : 'false'}
        />
        {errors.description && (
          <p className="text-sm text-destructive">{errors.description.message}</p>
        )}
      </div>

      <div>
        <Label htmlFor="fundingGoal">Funding Goal</Label>
        <Input
          id="fundingGoal"
          type="number"
          step="0.01"
          {...register('fundingGoal')}
          aria-invalid={errors.fundingGoal ? 'true' : 'false'}
        />
        {errors.fundingGoal && (
          <p className="text-sm text-destructive">{errors.fundingGoal.message}</p>
        )}
      </div>

      <Button type="submit" disabled={isLoading}>
        {isLoading ? 'Creating...' : 'Create Campaign'}
      </Button>
    </form>
  );
}
```

### Server Actions with Forms
```typescript
// components/campaign/update-form.tsx
import { updateCampaign } from '@/lib/actions/campaign-actions';
import { useFormState } from 'react-dom';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';

export function CampaignUpdateForm({ campaign }: { campaign: Campaign }) {
  const [state, formAction] = useFormState(updateCampaign, null);

  return (
    <form action={formAction} className="space-y-4">
      <input type="hidden" name="id" value={campaign.id} />
      
      <div>
        <Label htmlFor="title">Title</Label>
        <Input
          id="title"
          name="title"
          defaultValue={campaign.title}
          required
        />
      </div>

      <div>
        <Label htmlFor="description">Description</Label>
        <Textarea
          id="description"
          name="description"
          defaultValue={campaign.description}
          required
        />
      </div>

      <Button type="submit">Update Campaign</Button>
      
      {state?.error && (
        <div className="text-sm text-destructive">{state.error}</div>
      )}
      {state?.success && (
        <div className="text-sm text-green-600">Campaign updated successfully!</div>
      )}
    </form>
  );
}
```

## Loading and Error States

### Loading Components
```typescript
// components/ui/loading.tsx
import { Loader2 } from 'lucide-react';

export function LoadingSpinner({ className }: { className?: string }) {
  return (
    <Loader2 className={cn('h-4 w-4 animate-spin', className)} />
  );
}

export function LoadingCard() {
  return (
    <div className="animate-pulse">
      <div className="h-48 bg-muted rounded-lg mb-4"></div>
      <div className="h-4 bg-muted rounded mb-2"></div>
      <div className="h-4 bg-muted rounded w-3/4"></div>
    </div>
  );
}
```

### Error Boundaries
```typescript
// components/error-boundary.tsx
'use client';

import { Component, type ReactNode } from 'react';
import { Button } from '@/components/ui/button';

interface ErrorBoundaryProps {
  children: ReactNode;
  fallback?: ReactNode;
}

interface ErrorBoundaryState {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
  constructor(props: ErrorBoundaryProps) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        this.props.fallback || (
          <div className="text-center py-8">
            <h2 className="text-lg font-semibold mb-2">Something went wrong</h2>
            <p className="text-muted-foreground mb-4">
              {this.state.error?.message || 'An unexpected error occurred'}
            </p>
            <Button onClick={() => this.setState({ hasError: false })}>
              Try again
            </Button>
          </div>
        )
      );
    }

    return this.props.children;
  }
}
```

## Data Fetching Components

### Using React Query
```typescript
// components/campaign/campaign-list.tsx
import { useQuery } from '@tanstack/react-query';
import { getCampaigns } from '@/lib/api/campaigns';
import { CampaignCard } from './campaign-card';
import { LoadingCard } from '@/components/ui/loading';

export function CampaignList() {
  const {
    data: campaigns,
    isLoading,
    error,
  } = useQuery({
    queryKey: ['campaigns'],
    queryFn: getCampaigns,
  });

  if (isLoading) {
    return (
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {Array.from({ length: 6 }).map((_, i) => (
          <LoadingCard key={i} />
        ))}
      </div>
    );
  }

  if (error) {
    return (
      <div className="text-center py-8">
        <p className="text-destructive">Failed to load campaigns</p>
      </div>
    );
  }

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {campaigns?.map((campaign) => (
        <CampaignCard key={campaign.id} campaign={campaign} />
      ))}
    </div>
  );
}
```

## Modal and Dialog Components

### Dialog Usage
```typescript
// components/campaign/create-dialog.tsx
import { useState } from 'react';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { CampaignCreateForm } from './create-form';

export function CampaignCreateDialog() {
  const [open, setOpen] = useState(false);

  const handleSubmit = async (data: CampaignFormData) => {
    try {
      await createCampaign(data);
      setOpen(false);
    } catch (error) {
      console.error('Failed to create campaign:', error);
    }
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button>Create Campaign</Button>
      </DialogTrigger>
      <DialogContent className="sm:max-w-[425px]">
        <DialogHeader>
          <DialogTitle>Create New Campaign</DialogTitle>
        </DialogHeader>
        <CampaignCreateForm onSubmit={handleSubmit} />
      </DialogContent>
    </Dialog>
  );
}
```

## Accessibility Best Practices

### ARIA Attributes
- Use proper ARIA labels and descriptions
- Implement keyboard navigation
- Ensure proper focus management
- Use semantic HTML elements

### Screen Reader Support
```typescript
// components/campaign/campaign-stats.tsx
export function CampaignStats({ campaign }: { campaign: Campaign }) {
  return (
    <div className="grid grid-cols-2 gap-4">
      <div>
        <dt className="text-sm font-medium text-muted-foreground">
          Funding Goal
        </dt>
        <dd className="text-2xl font-bold" aria-label={`Goal: ${campaign.fundingGoal} ETH`}>
          {campaign.fundingGoal} ETH
        </dd>
      </div>
      <div>
        <dt className="text-sm font-medium text-muted-foreground">
          Amount Raised
        </dt>
        <dd className="text-2xl font-bold" aria-label={`Raised: ${campaign.amountRaised} ETH`}>
          {campaign.amountRaised} ETH
        </dd>
      </div>
    </div>
  );
}
```

## Performance Optimization

### React.memo Usage
```typescript
// components/campaign/campaign-card.tsx
import { memo } from 'react';

export const CampaignCard = memo(function CampaignCard({
  campaign,
  onFavorite,
}: CampaignCardProps) {
  // Component implementation
});
```

### Lazy Loading
```typescript
// components/campaign/campaign-details.tsx
import { lazy, Suspense } from 'react';
import { LoadingSpinner } from '@/components/ui/loading';

const CampaignChart = lazy(() => import('./campaign-chart'));

export function CampaignDetails({ campaign }: { campaign: Campaign }) {
  return (
    <div>
      <h1>{campaign.title}</h1>
      <Suspense fallback={<LoadingSpinner />}>
        <CampaignChart campaignId={campaign.id} />
      </Suspense>
    </div>
  );
}
```
